# Dev Log - 2025-12-27

> **å°ˆæ¡ˆ**: Fedora Phoenix
> **é‡Œç¨‹ç¢‘**: Day 1 - MVP æ¶æ§‹å»ºç«‹
> **ç‹€æ…‹**: æ ¸å¿ƒåŠŸèƒ½å®Œæˆï¼Œæº–å‚™æ•´åˆæ¸¬è©¦

---

## ğŸ¯ å°ˆæ¡ˆç›®æ¨™

å»ºç«‹ä¸€å€‹ **å–®äºŒé€²ä½æª”ã€é›¶ä¾è³´** çš„ Fedora Workstation è‡ªå‹•åŒ– Provisioning å·¥å…·ã€‚

æ ¸å¿ƒå“²å­¸ï¼š**Playbook æ¨¡å¼** - å¯é‡è¤‡åŸ·è¡Œã€å†ªç­‰æ€§ã€ç„¡éœ€ Rollbackã€‚

---

## âœ… å·²å®ŒæˆåŠŸèƒ½

### Block I: Identity & Configuration

- **Blueprint è¼‰å…¥**: æ”¯æ´ `phoenix.yml` å®£å‘Šå¼é…ç½®
- **Secrets è¼‰å…¥**: æ”¯æ´ `secrets.yml` ä¸¦è‡ªå‹•éŠ·æ¯€ï¼ˆé˜²æ­¢æ•æ„Ÿè³‡è¨Šå¤–æ´©ï¼‰
- **ä½¿ç”¨è€…åµæ¸¬**: è‡ªå‹•è­˜åˆ¥ sudo èƒŒå¾Œçš„çœŸå¯¦ä½¿ç”¨è€…ï¼ˆæ”¯æ´ X11/Waylandï¼‰

### Block II: Infrastructure

- **LUKS è§£é–**: è‡ªå‹•è§£é–åŠ å¯†åˆ†å‰²å€ï¼ˆ`cryptsetup luksOpen`ï¼‰
- **è£ç½®æ›è¼‰**: æ›è¼‰ LUKS è£ç½®åˆ°æŒ‡å®šç›®éŒ„
- **å†ªç­‰æ€§æª¢æŸ¥**: å·²è§£é–/å·²æ›è¼‰å‰‡è‡ªå‹•è·³é

### Block III: System State

- **å¥—ä»¶ç®¡ç†**:
  - å®‰è£ä¸€èˆ¬å¥—ä»¶ï¼ˆ`dnf install`ï¼‰
  - å®‰è£ä¸¦é–å®šç‰¹å®šç‰ˆæœ¬ï¼ˆ`dnf versionlock`ï¼‰
  - å†ªç­‰æ€§ï¼šå·²å®‰è£å‰‡è·³é
- **æœå‹™ç®¡ç†**:
  - å•Ÿç”¨ä¸¦å•Ÿå‹• systemd æœå‹™
  - å†ªç­‰æ€§ï¼šå·²å•Ÿç”¨ä¸”é‹è¡Œä¸­å‰‡è·³é
- **Shell è¨­å®š**: ä¿®æ”¹ä½¿ç”¨è€…é è¨­ Shell

### Block IV: User Space

- **Home ç›®éŒ„ç¢ºä¿**: è‡ªå‹•å»ºç«‹ä¸¦è¨­å®šæ­£ç¢ºæ¬Šé™ï¼ˆ0755 + ownershipï¼‰
- **è·¯å¾‘å±•é–‹**: æ”¯æ´ `~` ç¬¦è™Ÿè‡ªå‹•å±•é–‹ç‚ºå¯¦éš›è·¯å¾‘
- **Git Clone**: å¾é ç«¯å€‰åº« clone å°ˆæ¡ˆåˆ°æŒ‡å®šç›®éŒ„
- **Dotfiles éƒ¨ç½²**: æ”¯æ´ tarball è§£å£“ï¼ˆPhysical Copy æ¨¡å¼å¾… [ADR-0007](../adr/adr-0007-artifact-sync-harvesting.md) å¯¦ä½œï¼‰

---

## ğŸ—ï¸ æ¶æ§‹ç‰¹è‰²

### Playbook æ¨¡å¼

Phoenix æ¡ç”¨ **å®£å‘Šå¼é…ç½® + å†ªç­‰æ€§åŸ·è¡Œ**ï¼Œè€Œéå‚³çµ±çš„å‘½ä»¤å¼è…³æœ¬ï¼š

```yaml
# phoenix.yml - å®£å‘ŠæœŸæœ›ç‹€æ…‹
system:
  packages:
    - vim
    - git
  services:
    - sshd
```

**ç‰¹æ€§**:
- å¯ç„¡é™æ¬¡é‡è¤‡åŸ·è¡Œ
- è‡ªå‹•è·³éå·²å®Œæˆçš„æ­¥é©Ÿ
- å¤±æ•—å¾Œä¿®æ­£å•é¡Œç›´æ¥ rerunï¼ˆç„¡éœ€ Rollbackï¼‰

åƒè¦‹ [ADR-0005: Idempotency Pattern](../adr/adr-0005-idempotency-pattern.md)

---

### Check-Diff-Act æ¨¡å¼

æ‰€æœ‰ç³»çµ±æ“ä½œéµå¾ªä¸‰æ­¥é©Ÿï¼š

1. **Check**: æª¢æŸ¥ç•¶å‰ç‹€æ…‹
2. **Diff**: æ¯”å°æœŸæœ›ç‹€æ…‹
3. **Act**: åƒ…åœ¨ä¸ç¬¦åˆæ™‚åŸ·è¡Œè®Šæ›´

```go
// ç¯„ä¾‹ï¼šEnsurePackages
if rpm -q vim {
    log.Info("Package already installed, skipping")
    return
}
dnf install -y vim
```

---

### Session State ç®¡ç†

å¼•å…¥ Local Session Instance é›†ä¸­ç®¡ç†åŸ·è¡ŒæœŸç‹€æ…‹ï¼š

```go
sess := &session.Session{
    Blueprint:      // é…ç½®
    Secrets:        // æ©Ÿå¯†
    Username:       // ä½¿ç”¨è€…èº«ä»½
    UserHome:       // å±•é–‹å¾Œçš„è·¯å¾‘
    LuksUnlocked:   // Infrastructure ç‹€æ…‹
    // ...
}
```

å„ªå‹¢ï¼šæ˜ç¢ºçš„è³‡æ–™æµã€ç„¡å…¨åŸŸæ±¡æŸ“ã€æ˜“æ–¼æ¸¬è©¦

åƒè¦‹ [ADR-0006: Session State](../adr/adr-0006-session-state.md)

---

### Master-Replica Physical Copy

åŸºæ–¼ [ADR-0007](../adr/adr-0007-artifact-sync-harvesting.md)ï¼Œå»¢é™¤ Symlink ç­–ç•¥ï¼Œæ”¹ç”¨å¯¦é«”æª”æ¡ˆè¤‡è£½ï¼š

**è¨­è¨ˆç›®æ¨™**:
- **é›™å‘åŒæ­¥**: Provision (Repo â†’ System) + Harvest (System â†’ Repo)
- **ç²¾ç¢ºæ¬Šé™**: é€é State Store è¨˜éŒ„ Git ç„¡æ³•è¿½è¹¤çš„æ¬Šé™è³‡è¨Š
- **è‡ªå‹•ç›£æ§**: Systemd Daemon + Periodic Polling

**ç‹€æ…‹**: æ¶æ§‹å·²å®šç¾©ï¼Œå¯¦ä½œå¾…å®Œæˆ

---

## ğŸ”§ æŠ€è¡“å¯¦ä½œ

### å››å±¤æ¶æ§‹

```
cmd/phoenix/        # CLI é€²å…¥é»
internal/cmd/       # Cobra å‘½ä»¤ï¼ˆprovision, versionï¼‰
internal/ops/       # Act Functionsï¼ˆç³»çµ±æ“ä½œï¼Œéµå¾ªå†ªç­‰æ€§ï¼‰
internal/utils/     # ç´”å‡½æ•¸å·¥å…·ï¼ˆç„¡å‰¯ä½œç”¨ï¼‰
internal/config/    # é…ç½®è¼‰å…¥èˆ‡è§£æ
internal/session/   # åŸ·è¡ŒæœŸç‹€æ…‹ç®¡ç†
```

### ç‰ˆæœ¬ç®¡ç†

ä½¿ç”¨ Go å…§å»º VCS è¿½è¹¤ï¼š

```bash
$ phoenix version
Fedora Phoenix dev (commit: 57a2244-dirty)
```

è‡ªå‹•å¾ Git å–å¾— commit hash å’Œ dirty ç‹€æ…‹ï¼Œç„¡éœ€æ‰‹å‹•ç¶­è­·ç‰ˆæœ¬è™Ÿã€‚

---

## ğŸ“ æ¶æ§‹æ±ºç­–è¨˜éŒ„ (ADRs)

æœ¬å°ˆæ¡ˆå»ºç«‹äº†å®Œæ•´çš„ ADR é«”ç³»ï¼Œè¨˜éŒ„æ‰€æœ‰é‡è¦è¨­è¨ˆæ±ºç­–ï¼š

| ADR | ä¸»é¡Œ | æ ¸å¿ƒæ±ºç­– |
|-----|------|---------|
| [0001](../adr/adr-0001-pure-go-strategy.md) | Pure Go Strategy | å–®ä¸€ Binaryã€é›¶å¤–éƒ¨ä¾è³´ |
| [0002](../adr/adr-0002-block-architecture.md) | Block Architecture | å››éšæ®µåŸ·è¡Œæµç¨‹ |
| [0003](../adr/adr-0003-dotfiles-management.md) | Dotfiles Management | Artifact Injection + Git Clone |
| [0004](../adr/adr-0004-blueprint-pattern.md) | Blueprint Pattern | Engine-Blueprint åˆ†é›¢ |
| [0005](../adr/adr-0005-idempotency-pattern.md) | Idempotency Pattern | Check-Diff-Act æ¨¡å¼ |
| [0006](../adr/adr-0006-session-state.md) | Session State | Local Instance ç®¡ç† |
| [0007](../adr/adr-0007-artifact-sync-harvesting.md) | Artifact Sync | Physical Copy + Harvesting |

---

## ğŸš€ åŠŸèƒ½æ¼”é€²

### Dotfiles éƒ¨ç½²ç­–ç•¥çš„æ¼”é€²

**éšæ®µä¸€** (ADR-0003): GNU Stow + Symlink
- å„ªå‹¢ï¼šç°¡å–®ã€ä¾è³´æˆç†Ÿå·¥å…·
- å•é¡Œï¼šè»Ÿé«”ç›¸å®¹æ€§ã€æ¬Šé™æ¨¡ç³Šã€å–®å‘æ€§

**éšæ®µäºŒ** (ADR-0007): Physical Copy + State Store
- è§£æ±ºç›¸å®¹æ€§å•é¡Œï¼ˆSSHã€GPG ä¸æ”¯æ´ Symlinkï¼‰
- æ”¯æ´é›™å‘åŒæ­¥ï¼ˆHarvest åŠŸèƒ½ï¼‰
- ç²¾ç¢ºæ¬Šé™è¿½è¹¤ï¼ˆGit ç„¡æ³•è¨˜éŒ„ Unix permissionsï¼‰

åƒè¦‹ [Anti-Requirements](../anti-requirements.md) äº†è§£ç‚ºä½•ä¸éœ€è¦ Rollback æ©Ÿåˆ¶ã€‚

---

## ğŸ“Š å°ˆæ¡ˆç‹€æ…‹

### åŠŸèƒ½å®Œæˆåº¦

| æ¨¡çµ„ | ç‹€æ…‹ | å‚™è¨» |
|------|------|------|
| CLI æ¶æ§‹ | âœ… å®Œæˆ | Cobra framework |
| Blueprint è¼‰å…¥ | âœ… å®Œæˆ | YAML parsing |
| Secrets ç®¡ç† | âœ… å®Œæˆ | è‡ªå‹•éŠ·æ¯€ |
| ä½¿ç”¨è€…åµæ¸¬ | âœ… å®Œæˆ | X11/Wayland æ”¯æ´ |
| LUKS ç®¡ç† | âœ… å®Œæˆ | å†ªç­‰æ€§ |
| å¥—ä»¶ç®¡ç† | âœ… å®Œæˆ | å«ç‰ˆæœ¬é–å®š |
| æœå‹™ç®¡ç† | âœ… å®Œæˆ | Systemd |
| è·¯å¾‘å±•é–‹ | âœ… å®Œæˆ | ~ ç¬¦è™Ÿæ”¯æ´ |
| Git Clone | âœ… å®Œæˆ | åŸºæœ¬åŠŸèƒ½ |
| Physical Copy | â³ å¾…å¯¦ä½œ | ADR-0007 |
| State Store | â³ å¾…å¯¦ä½œ | æ¬Šé™è¿½è¹¤ |
| Harvest åŠŸèƒ½ | â³ å¾…å¯¦ä½œ | åå‘åŒæ­¥ |
| Systemd Daemon | â³ å¾…å¯¦ä½œ | è‡ªå‹•ç›£æ§ |

### æ¸¬è©¦ç‹€æ…‹

- âœ… ç·¨è­¯æˆåŠŸ (`go build ./...`)
- âœ… ç‰ˆæœ¬å‘½ä»¤é©—è­‰
- â³ æ•´åˆæ¸¬è©¦ï¼ˆå¯¦éš› Provisioning æµç¨‹ï¼‰
- â³ å†ªç­‰æ€§é©—è­‰ï¼ˆé‡è¤‡åŸ·è¡Œæ¸¬è©¦ï¼‰

---

## ğŸ¯ ä¸‹ä¸€æ­¥

### å„ªå…ˆç´š 1: å®Œæˆ ADR-0007 å¯¦ä½œ
1. State Store æ©Ÿåˆ¶ï¼ˆæ¬Šé™ + Hash è¿½è¹¤ï¼‰
2. Physical Copy åŒæ­¥é‚è¼¯
3. Harvest åŠŸèƒ½ï¼ˆSystem â†’ Repoï¼‰
4. Systemd Daemon ç®¡ç†

### å„ªå…ˆç´š 2: æ•´åˆæ¸¬è©¦
1. å»ºç«‹æ¸¬è©¦ç’°å¢ƒ
2. åŸ·è¡Œå®Œæ•´ Provisioning æµç¨‹
3. é©—è­‰å†ªç­‰æ€§ï¼ˆå¤šæ¬¡åŸ·è¡Œï¼‰

### å„ªå…ˆç´š 3: ä½¿ç”¨è€…æ–‡ä»¶
1. æ’°å¯«ä½¿ç”¨æ‰‹å†Š
2. å»ºç«‹ç¯„ä¾‹ Blueprint
3. å¸¸è¦‹å•é¡Œ (FAQ)

---

**å°ˆæ¡ˆé€²åº¦**: æ¶æ§‹å®Œæˆ 90% | æ ¸å¿ƒåŠŸèƒ½ 65% | æ–‡ä»¶ 85%

**ä¸‹ä¸€å€‹é‡Œç¨‹ç¢‘**: å¯¦ä½œ ADR-0007 ä¸¦å®Œæˆé¦–æ¬¡å®Œæ•´ Provisioning æ¸¬è©¦

**æ ¸å¿ƒå“²å­¸**: åƒè¦‹ [Core Philosophy](../core-philosophy.md)
